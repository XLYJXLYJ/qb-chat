<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="shortcut icon" href="./img/qibao.png" type="image/x-icon"/>
    <link rel="stylesheet" href="css/common.css"/>


    <style>
        /* .conent {
            font-size: 0;
        } */

        .robot_settings > div {
            margin-bottom: 20px;
        }

        .robot_settings > div > span:first-child + p {
            display: inline-block;
            float: left;
            margin-left: 6px;
            font-size: 14px;
            max-width: 500px;
            white-space: normal;
            word-break: break-all;
        }

        .robot_base_message > div:nth-child(2) {
            font-size: 14px;
        }

        .robot_settings > div > span:first-child {
            width: 100px;
        }

        .robot_settings > div > span.robot_hosting {
            width: 80px;
            padding: 3px;
            border-radius: 3px;
            cursor: pointer;
        }

        .robot_settings .robot_hosting + span {
            content: '';
            display: inline-block;
            background: url(img/question.png) no-repeat;
            width: 25px;
            height: 25px;
            margin-top: 6px;
            margin-left: 10px;
        }

        .robot_settings .robot_hosting:hover {
            background-color: #524AE7;
            color: white;
        }

        .robots {
            float: left;
            margin-bottom: 40px;
        }

        .product_id {
            display: none;
        }

        .robot_code {
            display: block;
        }

        .robot_base_message {
            width: 800px;
        }

        .robot_base_message div:nth-child(2) {
            margin-top: -80px;
        }

        .robot_base_message span {
            display: block;
        }

        .rightWord span {
            margin-top: 5px;
            width: 500px;
        }

        .robot_settings .remark {
            display: none;
            color: #ee4e4e;
            margin-top: 10px;
            margin-left: 120px;
        }
    </style>
</head>

<body>
<div id="count">
    <div class="top">
        <span>当前位置:<span class="current">管理中心</span><span>></span><span
                class="current">机器人管理</span></span><span>></span><span class="active">详情</span></span>
        <span>
					<a href='user.html'><span class="user"></span><span class="username"></span><span
                            class="company"></span></a>
					<span class="login_out">退出</span>
				</span>

    </div>
    <div class="aside">
        <div class="logo">
            <div>
                <div>企保科技</div>
                <p>科技连接保险未来</p>
            </div>
        </div>
        <div class="list">
            <ul>
                <li class="li_father">
                    <a href="index.html">
                        <span class="icon icon1"></span>
                        <span>概况统计</span>
                        <!--<span class="left active"></span>-->
                    </a>
                </li>
                <li class="li_father">
                    <a class="active">
                        <span class="icon icon2"></span>
                            <span>管理中心</span>
                            <span class="left active"></span>
                    </a>
                    <ul class="show">
                        <li class="li_sub">
                            <a href="robot_manage.html">
                                <span class="icon icon4"></span>
                                <span>机器人管理</span>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="platform_manage.html">
                                <span class="icon icon3"></span>
                                <span>平台管理</span>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="product_manage.html">
                                <span class="icon icon5"></span>
                                <span>保险产品管理</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <!--  <li class="li_father">
                      <a>
                          <span class="icon icon11"></span>
                          <span>训练中心</span>
                          <span class="left"></span>
                      </a>
                      <ul>
                          <li class="li_sub">
                              <a href="history.html">
                                  <span class="icon icon6"></span>
                                  <span>历史对话</span>
                              </a>
                          </li>
                      </ul>
                  </li>-->
                <li class="li_father">
                    <a>
                        <span class="icon icon7"></span>
                        <span>用户中心</span>
                        <span class="left"></span>
                    </a>
                    <ul>
                        <li class="li_sub">
                        <li class="li_sub">
                            <a href="user.html">
                                <span class="icon icon8"></span>
                                <span>基本设置</span>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="manage.html">
                                <span class="icon icon9"></span>
                                <span>套餐&余额管理</span>
                                <sup></sup>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="order.html">
                                <span class="icon icon10"></span>
                                <span>流量订单管理</span>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="balance_order_management.html">
                                <span class="icon icon15"></span>
                                <span>余额订单管理</span>
                            </a>
                        </li>
                        </li>

                    </ul>
                </li>
                <li class="li_father">
                    <a>
                        <span class="icon icon13"></span>
                        <span>人工客服</span>
                        <span class="left"></span>
                    </a>
                    <ul>
                        <li class="li_sub">
                            <a href="customer_service_manage.html">
                                <span class="icon icon12"></span>
                                <span>客服管理</span>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="work_statistics.html">
                                <span class="icon icon14"></span>
                                <span>历史客服工作统计</span>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="the_day_work_statistics.html">
                                <span class="icon icon16"></span>
                                <span>当天客服工作统计</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="li_father">
                    <a>
                        <span class="icon icon17"></span>
                        <span>数据分析</span>
                        <span class="left"></span>
                    </a>
                    <ul>
                        <li class="li_sub">
                            <a href="data_statistics.html">
                                <span class="icon icon18"></span>
                                <span>销售漏斗</span>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="robotData.html">
                                <span class="icon icon6"></span>
                                <span>机器人数据</span>
                            </a>
                        </li>
                        <li class="li_sub">
                            <a href="serviceData.html">
                                <span class="icon icon20"></span>
                                <span>客服数据</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="li_father show_none" style="margin-left:8px;">
                    <a>
                        <span><img src="./img/qt01.png"></span>
                        <span>智能质检</span>
                        <span class="left"></span>
                    </a>
                    <ul>
                        <li class="li_sub">
                            <a href="qt.html" target="_blank">
                                <span><img src="./img/qt02.png"></span>
                                <span>语音质检</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="li_father">
                    <a class="callBtn">
                        <span class="icon icon19"></span>
                        <span>智能呼叫中心</span>
                        <!--<span class="left active"></span>-->
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="conent">
        <p class="conent_title">
            <span></span>
            <span>详情</span>
        </p>
        <div class="robots">
            <div class="robot_base_message">
                <div class="img">
                    <img src="http://open.qb-tech.net/img/aimi-big.png" alt="" style="width: 125px;height:125px;margin-left:30px;">
                </div>
                <!-- <div class="rightWord">
                    <span class="robot_name"></span>
                    <span class="robot_code"></span>
                    <span class="robot_type"></span>
                    <span class="deployment_form"></span>
                    <span class="uri"></span>
                </div> -->
            </div>
            
            <div class="robot_settings">
                <div>功能设置</div>
                <span class="product_id"></span>
                <div class="robot_name" style="display: flex;align-items: center;">
                    <span>平台配置：</span>
                    <p class="welcome_words"></p>
                    <select name="platform_name" id="platform_name">
                        <!-- <option value="齐欣">齐欣</option>
                        <option value="聚米">聚米</option> -->
                    </select>
                    <a href="platform_manage_detail.html?type=0" style="color: #524AE7;margin-left:20px;font-size:16px;">新增平台</a>
                </div>
                <div class="wait" style="display: flex;align-items: center;">
                    <span>保险产品配置：</span>
                    <p class="wait_words"></p>
                    <div id="product_set" style="display: flex;align-items: center;">
                        <!-- <input type="checkbox" name="product_set">1
                        <input type="checkbox" name="product_set">2
                        <input type="checkbox" name="product_set">3
                        <input type="checkbox" name="product_set">4 -->
                    </div>
                    <a href="product_manage_detail.html?type=0" style="color: #524AE7;margin-left:20px;font-size:16px;">新增保险产品</a>
                </div>
                <div class="timeout" style="display: flex;align-items: center;">
                    <span>默认回答保险产品：</span>
                    <p class="wait_words"></p>
                    <select name="default_product" id="default_product">
                        <!-- <option value="齐欣">齐欣</option>
                        <option value="聚米">聚米</option> -->
                    </select>
                </div>
                <div class="bottom_timeout" style="display: flex;align-items: center;">
                    <span>机器人托管：</span>
                    <p class="timeout_words"></p>
                    <input type="radio" name="robot_mana" value="1">开启
                    <input type="radio" name="robot_mana" value="0">关闭
                </div>
                <div class="comment" style="display: flex;align-items: center;">
                    <span>关联问题：</span>
                    <p class="timeout_words"></p>
                    <input type="radio" name="robot_ques" value="1">开启
                    <input type="radio" name="robot_ques" value="0">关闭
                </div>
                <div class="comment" style="display: flex;align-items: center;">
                    <span>闲聊：</span>
                    <p class="timeout_words"></p>
                    <input type="radio" name="robot_talk" value="1">开启
                    <input type="radio" name="robot_talk" value="0">关闭
                </div>
                <div class="comment" style="display: flex;align-items: center;">
                    <span>机器人类型：</span>
                    <p class="timeout_words"></p>
                    <select name="robot_type" id="robot_type">
                        <option value="理赔机器人">理赔机器人</option>
                        <option value="销售机器人">销售机器人</option>
                        <option value="咨询机器人">咨询机器人</option>
                    </select>
                </div>
                <div class="hosting">
                    <!-- <span class="robot_hosting">机器人托管</span>
                     <span title="点击机器人托管按钮后，在所有客服不在线时机器人将会自动回复客户。"></span>-->
                </div>
                <p class="remark red">*限100字以内</p>
                <span class="save">发布并保存</span>
            </div>
        </div>
    </div>
</div>
<script src="js/jquery.js"></script>
<script src="js/laydate.js"></script>
<script src="js/common.js"></script>
<script>
    $(function () {

        // var html = '';
        // var a = 111333;
        // var b = 222333;
        // html = '<option value = "'+ a +'">' + a + '</option>'
        // html += '<option value = "'+ b +'">' + b + '</option>'
        // $('#platform_name').append(html);
        // console.log(0)

        // var html2 = ''
        // var c = 111333666;
        // var d = 222333666;
        // html = '<input type="checkbox" name="set_product">'+c
        // html += '<input type="checkbox" name="set_product">'+d
        // $('#product_set').append(html);

        var str = '';
        var cookie;
        var url = location.search;
        var temp = [];
        if (url.indexOf("?") != -1) {
            var strs = url.substr(1);
            var str = strs.split("&");

            for (var i = 0; i < str.length; i++) {
                temp.push(str[i].split("="))
            }
            //console.log(temp)
                cookie = getCookie('user');
                cookie = cookie.split("&&");
                $.ajax({
                    type: "get",
                    url: "merchant/v2.0/robot/robot_config",
                    /*  url: "mockJson/xiangqing.json",*/
                    async: true,
                    // data: {'robot_id': temp[0][1]},
                    data: {'robot_id': temp[0][1]},
                    success: function (data) {
                        var html = '';
                        var html1 = '';
                        var html2 = '';
                        console.log(data.data)
                        if (data.status == '200') {
                            for(let i=0;i<data.data.platform_message.length;i++){
                                html += '<option value = "'+ data.data.platform_message[i].platform_manage_id +'">' + data.data.platform_message[i].platform_manage_name + '</option>'
                            }
                            $('#platform_name').append(html);

                            for(let i=0;i<data.data.product_message.length;i++){
                                html1 += '<input type="checkbox" name="set_product" value = "'+ data.data.product_message[i].product_manage_id +'">' + data.data.product_message[i].product_manage_name
                            }
                            $('#product_set').append(html1);

                            for(let i=0;i<data.data.platform_message.length;i++){
                                html2 += '<option value = "'+ data.data.platform_message[i].platform_manage_id +'">' + data.data.platform_message[i].platform_manage_name + '</option>'
                            }
                            $('#default_product').append(html2);

                            if(data.data.robot_hosting == 0){
                                $("input[name='robot_mana'][value=0]").attr("checked",true); 
                            }else{
                                $("input[name='robot_mana'][value=1]").attr("checked",true);
                            }

                            if(data.data.qas == 0){
                                $("input[name='robot_ques'][value=0]").attr("checked",true); 
                            }else{
                                $("input[name='robot_ques'][value=1]").attr("checked",true);
                            }

                            if(data.data.gossip == 0){
                                $("input[name='robot_talk'][value=0]").attr("checked",true); 
                            }else{
                                $("input[name='robot_talk'][value=1]").attr("checked",true);
                            }

                        } else if (data.errmsg == '用户未登录') {
                            window.location.href = "login.html";
                        }
                    }
                });

        }
        $(".comment .edit").click(function () {
            var this_ = $(this)
            if (this_.siblings('textarea').is(':hidden')) {
                this_.parents('.robot_settings').find('.remark.red').show();
            } else {
                this_.parents('.robot_settings').find('.remark.red').hide();
            }
        })
        $('.save').click(function () {
            var product_set = []
            var platform_name = $('#platform_name').val();
            var robot_type = $("#robot_type").val();
            var chk_value =[]; 
            $('input[name="set_product"]:checked').each(function(){ 
                chk_value.push($(this).val()); 
            }); 
            chk_value = chk_value.toString()
            var default_product = $("#default_product").val();
            var faq = $("input[name='robot_ques']:checked").val();
            var gossip = $("input[name='robot_talk']:checked").val();;
            var robot_hosting = $("input[name='robot_mana']:checked").val();;
            $.ajax({
                type: "post",
                url: "merchant/v2.0/robot/robot_config",
                /* url: "mockJson/xiangqing.json",*/
                async: true,
                // traditional: "true",
                data: {
                    robot_id:temp[0][1],
                    platform_manage_id:platform_name,
                    // robot_status:0,
                    robot_type:robot_type,
                    product_manage_id:chk_value,
                    default_product:default_product,
                    robot_hosting:robot_hosting,
                    faq:faq,
                    gossip:gossip,
                },
                success: function (data) {
                    if (data.data == '备注信息更新成功') {
                        alert("更新成功！");
                        window.location.href = "robot_manage.html";
                    } else if (data.errmsg == '用户未登录') {
                        window.location.href = "login.html";
                    }
                }
            });
        })
    });

    $(document).on('click', '.robot_hosting', function () {
        var this_ = $(this)
        if (this_.hasClass('active')) { //取消托管状态
            this_.removeClass('active');
            this_.text('机器人托管')
        } else {
            this_.addClass('active');
            this_.text('取消托管')
        }

    })
</script>
</body>

</html>